<!DOCTYPE html>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>

    <form class="form-inline">
      <!-- <label class="sr-only" for="inlineFormInputName2">Name</label>
      <input type="text" class="form-control mb-2 mr-sm-2" id="inlineFormInputName2" placeholder="Jane Doe">  -->

      <label class="sr-only" for="inlineFormInputGroupUsername2">Username</label>
      <div class="input-group mb-2 mr-sm-2">
        <div class="input-group-prepend">
          <div class="input-group-text">@</div>
        </div>
        <input type="text" class="form-control" id="inlineFormInputGroupUsername2" placeholder="Username">
      </div>
      <button type="submit" id="submit" class="btn btn-primary mb-2">Submit</button>
    </form>
    <h1 id="username"></h1>

    <!-- the script that stores Username -->
    <script type="text/javascript">

    if(!localStorage.getItem('username'))
        localStorage.setItem('username','');
    document.addEventListener('DOMContentLoaded', ()=> {
      document.querySelector('#username').innerHTML = localStorage.getItem('username');

      document.querySelector('#submit').onclick = () => {
        let username = document.querySelector('#inlineFormInputGroupUsername2').value;
        document.querySelector('#username').innerHTML = username;
        localStorage.setItem('username',username);

      }
    });

    </script>
    <style media="screen">
      #list_of_channels {
          height: 200px;
          width: 15%;
          background-color: white;
         }
    </style>
    <!-- button to create a new channel -->
    <!-- <style media="screen">
      #create_list{
        width: 15%;
      }
    </style> -->
  <div id='list_of_channels'>
    <!-- list of the channels -->
    <div class="list-group" id="list">
      <form class="form-inline" id='new_channel'>
        <label class="sr-only" for="inlineFormInputGroupUsername2">Username</label>
        <div class="input-group mb-2 mr-sm-2">
          <div class="input-group-prepend">
            <div class="input-group-text">@</div>
          </div>
          <button type="button" id="create_channel" class="list-group-item list-group-item-action">Create new channel</button>
          <input type="text" class="form-control" name="new_channels_name" id="new_channels_name" placeholder="Username">
        </div>
      </form>
    </div>
    <ul id="channels_list">
    </ul>
  </div>
  <!-- script of channels -->
  <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', () =>{
        // checks if we already have a stored list or not

        document.querySelector('#create_channel').disabled = true;

        document.querySelector('#new_channels_name').onkeyup = () =>{
          if (document.querySelector('#new_channels_name').value.length >0)
              document.querySelector('#create_channel').disabled = false;
          else
              document.querySelector('#create_channel').disabled = true;
        };
        document.querySelector('#create_channel').onclick = () =>{

          const request = new XMLHttpRequest();
          const channel_name = document.querySelector('#new_channels_name').value;
          request.open('POST','/messanger');

          request.onload = () => {
            const data = JSON.parse(request.responseText);

            if (data.success){
              const button = document.createElement('button');
              button.className = 'list-group-item list-group-item-action';
              button.innerHTML = data.channel;

              document.querySelector('#channels_list').append(button);
              document.querySelector('#new_channels_name').value = '';

              // return false;

            }
          }
          const data = new FormData();
          data.append('new_channels_name',channel_name);
          request.send(data);
          return false;

        }
      });

  </script>
  </body>
</html>
